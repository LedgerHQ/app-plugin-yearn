import "core-js/stable";
import "regenerator-runtime/runtime";
import { waitForAppScreen, zemu, nano_models, txFromEtherscan} from './test.fixture';

const BASE_SCREENS_S = (1 + 1 + 1 + 3 + 1) //YEARN + AMOUNT + VAULT + GAS_FEES + APPROVE
const BASE_SCREENS_X = (1 + 1 + 1 + 1 + 1) //YEARN + AMOUNT + VAULT + GAS_FEES + APPROVE

nano_models.forEach(function(model) {
  test('[Nano ' + model.letter + '] Zap In Eth', zemu(model, async (sim, eth) => {
      const serializedTx = txFromEtherscan("0x"+"02f9021b01048459682f0085057b43cde9830418cc94c2c171bd6fc3b5885b589ed8b4d135f31085e973891a4aba225c20740000b901a4b6c2c6e9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a4aba225c20740000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000a258c4606ca8206d8aa700ce2143d7db854d168c0000000000000000000000000000000000000000000000196f8b397a5ab74ecd000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000120000000000000000000000000feb4acf3df3cdea7399794d0869ef76a6efaff52000000000000000000000000fbd4c3d8be6b15b7cf428db2838bb44c0054fcd20000000000000000000000000000000000000000000000000000000000000048d0e30db0869584cd000000000000000000000000fbd4c3d8be6b15b7cf428db2838bb44c0054fcd2000000000000000000000000000000000000000000000083267e1eb3637400fb000000000000000000000000000000000000000000000000c001a0e1779b8237a28041f3eea7aae5cbf0d30bbffd56bb38cafb1eec0c2667eacad1a061b8c94b1dec4c78b25317ad9a235f6adc90bfe679df359e07d0765758734bb9");

      const tx = eth.signTransaction("44'/60'/0'/0", serializedTx);
      const right_clicks = model.letter === 'S' ? BASE_SCREENS_S : BASE_SCREENS_X;
      await waitForAppScreen(sim);
      await sim.navigateAndCompareSnapshots('.', model.name + '_zapin_eth_weth', [right_clicks, 0]);
      await tx;
  }));
});
